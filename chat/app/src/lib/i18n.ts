export type Lang = 'en' | 'fa';

type CopyValue = string | ((...args: any[]) => string);
type Copy = Record<string, CopyValue>;

export const LANG_KEY = 'dnscloak-lang';

const copy: Record<Lang, Copy> = {
  en: {
    app_name: 'DNSCloak',
    tagline: 'Uncensored and Decentralized',
    guide: 'Guide',
    language_toggle: 'فارسی',
    home: 'Home',
    rooms: 'Rooms',
    nodes: 'Nodes',
    create_room: 'Create room',
    join_room: 'Join room',
    latest_rooms: 'Latest rooms',
    refreshing: 'Refreshing...',
    listed: (count: number) => `${count} listed`,
    no_active_rooms: 'No active rooms shared yet.',
    no_matching_rooms: 'No matching rooms right now.',
    search_by_emoji: 'Search by emoji ID',
    all_rooms: 'All rooms',
    match: (count: number) => `${count} match`,
    no_description: 'No description provided.',
    join: 'Join',
    room_emojis: 'Room emojis',
    pin: 'PIN',
    pin_placeholder: '••••••',
    username_optional: 'Username (optional)',
    username_placeholder: 'Leave blank for random',
    create: 'Create room',
    join_action: 'Join room',
    back: 'Back',
    pick_all_emojis: 'Pick all 6 emojis.',
    pin_length_create: 'Enter a 6-digit PIN.',
    pin_length_join: 'Enter the 6-digit PIN.',
    creating_room: 'Creating room...',
    joining_room: 'Joining room...',
    room_created: 'Room created. Messages are end-to-end encrypted.',
    room_joined: 'You joined the room. Messages are end-to-end encrypted.',
    failed_create: 'Failed to create room.',
    failed_join: 'Failed to join room.',
    room_missing_emojis: 'Room listing missing emojis. Ask the creator for the 6-emoji ID.',
    description_label: 'Description (optional)',
    description_placeholder: 'Short description, include PIN if you want it public',
    connected_node: 'Connected node',
    connect_node: 'Connect node',
    ready: 'Ready',
    offline: 'Offline',
    online: 'Online',
    fails: (count: number) => `fails ${count}`,
    add_node: 'Add node',
    checking_nodes: 'Checking nodes...',
    no_nodes: 'No nodes reachable from genesis. Add a node URL if you have one.',
    nodes_label: 'Nodes',
    node_directory_refresh: 'Node directory refresh:',
    nodes_in: 'nodes in',
    rooms_in: 'rooms in',
    add_node_title: 'Add node',
    add_node_help: 'Paste a node URL and add it to your list.',
    add_node_placeholder: 'https://your-node.workers.dev',
    cancel: 'Cancel',
    add: 'Add',
    room_created_at: 'Room created.',
    chat: 'Chat',
    leave: 'Leave',
    mode_fixed: 'Mode: fixed',
    expires_in: 'Expires in:',
    members_online: (count: number) => `${count} online`,
    connection_lost: 'Connection lost. Retrying...',
    no_messages: 'No messages yet',
    type_message: 'Type a message',
    send: 'Send',
    message_too_long: 'Message too long.',
    send_failed: 'Send failed.',
    could_not_decrypt: '[Could not decrypt]',
    install_title: 'Install this app',
    install_body: 'Add DNSCloak Chat to your device for a faster, app-like experience.',
    install_unavailable: 'Install is not available yet on this browser.',
    dont_show_again: "Don't show again",
    install: 'Install',
    close: 'Close',
    room_list_missing_emojis: 'Room listing missing emojis. Ask the creator for the 6-emoji ID.',
    quick_guide: 'Quick guide',
    guide_intro:
      'This app lets you make private chat rooms using a 6-emoji ID and a 6-digit PIN. Everything is end-to-end encrypted.',
    guide_create_title: 'Create a room',
    guide_create_1: 'Tap Create room, pick 6 emojis, and set a 6-digit PIN.',
    guide_create_2: 'Optional: add a short description so others know what the room is for.',
    guide_create_3: 'Optional: add a username. If you leave it blank, we make a random one.',
    guide_create_4: 'Share the 6 emojis and the PIN with people you want to invite.',
    guide_join_title: 'Join a room',
    guide_join_1: 'Tap Join room and enter the same 6 emojis.',
    guide_join_2: 'Enter the 6-digit PIN from the creator.',
    guide_join_3: 'Pick a username or leave it blank for a random one.',
    guide_join_4: 'If the room was listed, you can also join from the Rooms list.',
    guide_desc_title: 'Descriptions and PINs',
    guide_desc_1: 'The description is public in the room list. Keep it short.',
    guide_desc_2: 'Never post a PIN unless you want anyone to join.',
    guide_desc_3: 'The PIN is required to decrypt messages.',
    guide_chat_title: 'Chat',
    guide_chat_1: 'Type your message and press Send.',
    guide_chat_2: 'You will see the room emojis, member count, and time left.',
    guide_chat_3: 'Use Leave to exit the room.',
    guide_rooms_title: 'Rooms list',
    guide_rooms_1: 'The Rooms tab shows public rooms shared with a description.',
    guide_rooms_2: 'You can filter rooms by emoji ID.',
    guide_rooms_3: 'Rooms expire automatically, so they may disappear.',
    guide_nodes_title: 'Nodes',
    guide_nodes_1: 'The Nodes tab shows available relay nodes.',
    guide_nodes_2: 'Tap a node to connect to it.',
    guide_nodes_3: 'Use Add node if you have a custom node URL.',
    back_home: 'Back to home',
    pick_emojis: 'Pick 6 emojis',
    tap_to_remove: 'Tap to remove',
    more_remaining: (count: number) => `${count} more`,
    clear: 'Clear',
    toggle_theme: 'Toggle theme'
  },
  fa: {
    app_name: 'DNSCloak',
    tagline: 'بدون سانسور و غیرمتمرکز',
    guide: 'راهنما',
    language_toggle: 'English',
    home: 'خانه',
    rooms: 'اتاق‌ها',
    nodes: 'نودها',
    create_room: 'ساخت اتاق',
    join_room: 'ورود به اتاق',
    latest_rooms: 'آخرین اتاق‌ها',
    refreshing: 'در حال به‌روزرسانی...',
    listed: (count: number) => `${count} مورد`,
    no_active_rooms: 'اتاق فعالی پیدا نشد.',
    no_matching_rooms: 'هیچ اتاقی پیدا نشد.',
    search_by_emoji: 'جستجو با شناسه ایموجی',
    all_rooms: 'همه اتاق‌ها',
    match: (count: number) => `${count} نتیجه`,
    no_description: 'توضیحی ثبت نشده.',
    join: 'ورود',
    room_emojis: 'ایموجی‌های اتاق',
    pin: 'پین',
    pin_placeholder: '••••••',
    username_optional: 'نام کاربری (اختیاری)',
    username_placeholder: 'خالی بگذارید برای نام تصادفی',
    create: 'ساخت اتاق',
    join_action: 'ورود به اتاق',
    back: 'برگشت',
    pick_all_emojis: 'هر ۶ ایموجی را انتخاب کنید.',
    pin_length_create: 'پین ۶ رقمی را وارد کنید.',
    pin_length_join: 'پین ۶ رقمی را وارد کنید.',
    creating_room: 'در حال ساخت اتاق...',
    joining_room: 'در حال ورود به اتاق...',
    room_created: 'اتاق ساخته شد. پیام‌ها انتها‌به‌انتها رمزگذاری می‌شوند.',
    room_joined: 'به اتاق وارد شدید. پیام‌ها انتها‌به‌انتها رمزگذاری می‌شوند.',
    failed_create: 'ساخت اتاق ناموفق بود.',
    failed_join: 'ورود به اتاق ناموفق بود.',
    room_missing_emojis: 'فهرست اتاق ایموجی ندارد. شناسه ۶ ایموجی را از سازنده بگیرید.',
    description_label: 'توضیحات (اختیاری)',
    description_placeholder: 'توضیح کوتاه، اگر عمومی می‌خواهید پین را هم بنویسید',
    connected_node: 'نود متصل',
    connect_node: 'اتصال به نود',
    ready: 'آماده',
    offline: 'آفلاین',
    online: 'آنلاین',
    fails: (count: number) => `خطا ${count}`,
    add_node: 'افزودن نود',
    checking_nodes: 'در حال بررسی نودها...',
    no_nodes: 'هیچ نودی از جنسیس در دسترس نیست. اگر دارید آدرس نود را اضافه کنید.',
    nodes_label: 'نودها',
    node_directory_refresh: 'به‌روزرسانی فهرست نودها:',
    nodes_in: 'نودها تا',
    rooms_in: 'اتاق‌ها تا',
    add_node_title: 'افزودن نود',
    add_node_help: 'آدرس نود را وارد کنید و به فهرست اضافه کنید.',
    add_node_placeholder: 'https://your-node.workers.dev',
    cancel: 'لغو',
    add: 'افزودن',
    room_created_at: 'اتاق ساخته شد.',
    chat: 'چت',
    leave: 'خروج',
    mode_fixed: 'حالت: ثابت',
    expires_in: 'زمان باقیمانده:',
    members_online: (count: number) => `${count} نفر آنلاین`,
    connection_lost: 'اتصال قطع شد. تلاش مجدد...',
    no_messages: 'هنوز پیامی نیست',
    type_message: 'پیام بنویسید',
    send: 'ارسال',
    message_too_long: 'پیام خیلی طولانی است.',
    send_failed: 'ارسال ناموفق بود.',
    could_not_decrypt: '[قابل رمزگشایی نیست]',
    install_title: 'نصب این برنامه',
    install_body: 'DNSCloak Chat را برای تجربه سریع‌تر و شبیه اپ نصب کنید.',
    install_unavailable: 'نصب در این مرورگر در دسترس نیست.',
    dont_show_again: 'دیگر نشان نده',
    install: 'نصب',
    close: 'بستن',
    room_list_missing_emojis: 'فهرست اتاق ایموجی ندارد. شناسه ۶ ایموجی را از سازنده بگیرید.',
    quick_guide: 'راهنمای سریع',
    guide_intro:
      'این برنامه به شما اجازه می‌دهد اتاق خصوصی با شناسه ۶ ایموجی و پین ۶ رقمی بسازید. همه چیز انتها‌به‌انتها رمزگذاری می‌شود.',
    guide_create_title: 'ساخت اتاق',
    guide_create_1: 'روی ساخت اتاق بزنید، ۶ ایموجی انتخاب کنید و پین ۶ رقمی بگذارید.',
    guide_create_2: 'اختیاری: توضیح کوتاه بنویسید تا دیگران بدانند اتاق برای چیست.',
    guide_create_3: 'اختیاری: نام کاربری بگذارید. اگر خالی باشد، تصادفی ساخته می‌شود.',
    guide_create_4: '۶ ایموجی و پین را با افرادی که می‌خواهید دعوت کنید به اشتراک بگذارید.',
    guide_join_title: 'ورود به اتاق',
    guide_join_1: 'روی ورود به اتاق بزنید و همان ۶ ایموجی را وارد کنید.',
    guide_join_2: 'پین ۶ رقمی را از سازنده بگیرید و وارد کنید.',
    guide_join_3: 'نام کاربری انتخاب کنید یا خالی بگذارید برای نام تصادفی.',
    guide_join_4: 'اگر اتاق لیست شده باشد از تب اتاق‌ها هم می‌توانید وارد شوید.',
    guide_desc_title: 'توضیحات و پین',
    guide_desc_1: 'توضیحات در لیست اتاق‌ها عمومی است. کوتاه بنویسید.',
    guide_desc_2: 'پین را فقط وقتی عمومی کنید که می‌خواهید همه وارد شوند.',
    guide_desc_3: 'برای خواندن پیام‌ها، پین لازم است.',
    guide_chat_title: 'چت',
    guide_chat_1: 'پیام بنویسید و ارسال را بزنید.',
    guide_chat_2: 'ایموجی‌های اتاق، تعداد اعضا و زمان باقی‌مانده را می‌بینید.',
    guide_chat_3: 'برای خروج از دکمه خروج استفاده کنید.',
    guide_rooms_title: 'لیست اتاق‌ها',
    guide_rooms_1: 'تب اتاق‌ها، اتاق‌های عمومی با توضیح را نشان می‌دهد.',
    guide_rooms_2: 'می‌توانید بر اساس شناسه ایموجی فیلتر کنید.',
    guide_rooms_3: 'اتاق‌ها خودکار منقضی می‌شوند و ممکن است ناپدید شوند.',
    guide_nodes_title: 'نودها',
    guide_nodes_1: 'تب نودها، نودهای رله موجود را نشان می‌دهد.',
    guide_nodes_2: 'برای اتصال روی یک نود بزنید.',
    guide_nodes_3: 'اگر نود سفارشی دارید از افزودن نود استفاده کنید.',
    back_home: 'بازگشت به خانه',
    pick_emojis: '۶ ایموجی را انتخاب کنید',
    tap_to_remove: 'برای حذف بزنید',
    more_remaining: (count: number) => `${count} مورد دیگر`,
    clear: 'پاک کردن',
    toggle_theme: 'تغییر تم'
  }
};

export function getInitialLang(): Lang {
  if (typeof window === 'undefined') return 'en';
  const stored = window.localStorage.getItem(LANG_KEY);
  if (stored === 'fa' || stored === 'en') return stored;
  return 'en';
}

export function t(lang: Lang, key: string, ...args: any[]) {
  const value = copy[lang][key] ?? copy.en[key];
  if (typeof value === 'function') return value(...args);
  return value ?? key;
}

export function isRtl(lang: Lang) {
  return lang === 'fa';
}
